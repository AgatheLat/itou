version: "3.7"

services:

  # https://github.com/appropriate/docker-postgis
  # https://hub.docker.com/r/mdillon/postgis/tags
  postgres:
    container_name: itou_postgres_staging
    env_file:
      - ./envs/staging.env
    image: mdillon/postgis:11
    volumes:
      - postgres_data_staging:/var/lib/postgresql/data
      - ./docker/staging/postgres/psql_init.sh:/docker-entrypoint-initdb.d/postgres-init.sh
    restart: always
    ports:
      - "127.0.0.1:5433:5432"

  django:
    container_name: itou_django_staging
    env_file:
      - ./envs/staging.env
      - ./envs/secrets.env
    depends_on:
      - postgres
    build:
      context: .
      dockerfile: ./docker/staging/django/Dockerfile
    restart: always
    ports:
      - "127.0.0.1:8001:8000"

volumes:
  postgres_data_staging:
